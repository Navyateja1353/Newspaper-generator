<!DOCTYPE html>
<html lang="te">
<head>
<meta charset="UTF-8">
<title>‡∞ú‡∞®‡∞Ç ‡∞®‡±ç‡∞Ø‡±Ç‡∞∏‡±ç - ‡∞™‡±Ç‡∞∞‡±ç‡∞§‡∞ø ‡∞µ‡∞æ‡∞∞‡±ç‡∞§‡∞≤ ‡∞é‡∞°‡∞ø‡∞∑‡∞®‡±ç</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Telugu:wght@400;600;700&display=swap" rel="stylesheet">

<style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    @page { size: A4; margin: 0; }
    body { background: #222; font-family: 'Noto Sans Telugu', sans-serif; padding-bottom: 50px; }

    .page {
        width: 210mm; 
        min-height: 297mm; /* Height ‡∞®‡∞ø ‡∞´‡∞ø‡∞ï‡±ç‡∞∏‡±ç ‡∞ö‡±á‡∞Ø‡∞ï‡±Å‡∞Ç‡∞°‡∞æ min-height ‡∞á‡∞ö‡±ç‡∞ö‡∞æ‡∞®‡±Å */
        background: white; 
        margin: 10mm auto;
        padding: 12mm; 
        position: relative; 
        page-break-after: always;
        border: 6px double black; 
    }

    .category-ribbon {
        background: #b91c1c; color: #fff; padding: 4px 12px;
        font-size: 13px; font-weight: bold; display: inline-block; margin-bottom: 5px;
    }

    .header { text-align: center; border-bottom: 3px solid black; margin-bottom: 5mm; }
    .header h1 { font-size: 50px; font-weight: 800; color: #b91c1c; }
    
    .header-meta {
        display: flex; justify-content: space-between; font-weight: bold;
        font-size: 13px; border-top: 1px solid black; padding: 5px 10px;
    }

    /* 3 Column Layout - Fixed Overflow */
    .columns {
        column-count: 3; 
        column-gap: 15px; 
        column-rule: 0.5px solid #ccc;
        text-align: justify;
    }

    /* ‡∞¨‡∞æ‡∞ï‡±ç‡∞∏‡±ç ‡∞≤‡±ã‡∞™‡∞≤ ‡∞µ‡∞æ‡∞∞‡±ç‡∞§ ‡∞ï‡∞ü‡±ç ‡∞Ö‡∞µ‡±ç‡∞µ‡∞ï‡±Å‡∞Ç‡∞°‡∞æ ‡∞â‡∞Ç‡∞°‡±á‡∞≤‡∞æ ‡∞Æ‡∞æ‡∞∞‡±ç‡∞™‡±Å‡∞≤‡±Å */
    .news-box {
        display: block;
        width: 100%;
        margin-bottom: 15px; 
        padding: 8px; 
        border: 1px solid #000;
        background: #fff;
        page-break-inside: avoid; /* ‡∞µ‡∞æ‡∞∞‡±ç‡∞§ ‡∞Æ‡∞ß‡±ç‡∞Ø‡∞≤‡±ã ‡∞µ‡∞ø‡∞∞‡∞ø‡∞ó‡∞ø‡∞™‡±ã‡∞ï‡±Å‡∞Ç‡∞°‡∞æ ‡∞ö‡±Ç‡∞∏‡±ç‡∞§‡±Å‡∞Ç‡∞¶‡∞ø */
        break-inside: avoid-column;
    }

    .news-box h2 {
        font-size: 15px; margin-bottom: 6px; color: #000;
        border-bottom: 2px solid #b91c1c; padding-bottom: 2px;
    }

    .news-box img {
        width: 100%; height: auto; /* Image size ‡∞®‡∞ø ‡∞´‡∞ø‡∞ï‡±ç‡∞∏‡±ç ‡∞ö‡±á‡∞Ø‡∞≤‡±á‡∞¶‡±Å */
        max-height: 250px; object-fit: contain;
        margin-bottom: 8px; border: 1px solid #ddd;
    }

    .news-box p { 
        font-size: 11.5px; 
        line-height: 1.6; 
        color: #111;
        white-space: pre-wrap; /* ‡∞ï‡±ä‡∞§‡±ç‡∞§ ‡∞≤‡±à‡∞®‡±ç‡∞≤‡∞®‡±Å ‡∞ó‡±Å‡∞∞‡±ç‡∞§‡∞ø‡∞∏‡±ç‡∞§‡±Å‡∞Ç‡∞¶‡∞ø */
    }

    #ui { background: white; padding: 20px; text-align: center; border-bottom: 5px solid #b91c1c; position: sticky; top:0; z-index:100; }
</style>
</head>
<body>

<div id="ui">
    <h2>üì∞ ‡∞ú‡∞®‡∞Ç ‡∞®‡±ç‡∞Ø‡±Ç‡∞∏‡±ç - Full Content Version</h2>
    <input type="file" id="zipInput" accept=".zip">
    <p class="small mt-2">‡∞µ‡∞∞‡±ç‡∞ó‡±Ä‡∞ï‡∞∞‡∞£: ‡∞∞‡∞æ‡∞ú‡∞ï‡±Ä‡∞Ø‡∞Ç | ‡∞µ‡∞ø‡∞¶‡±ç‡∞Ø | ‡∞ï‡±ç‡∞∞‡±Ä‡∞°‡∞≤‡±Å | ‡∞µ‡±ç‡∞Ø‡∞µ‡∞∏‡∞æ‡∞Ø‡∞Ç | ‡∞®‡±á‡∞∞‡∞æ‡∞≤‡±Å</p>
</div>

<div id="paper"></div>

<script>
let imageMap = {};

// ‡∞µ‡∞∞‡±ç‡∞ó‡±Ä‡∞ï‡∞∞‡∞£ ‡∞ï‡±Ä‡∞µ‡∞∞‡±ç‡∞°‡±ç‡∞∏‡±ç
const categories = {
    "‡∞µ‡∞ø‡∞¶‡±ç‡∞Ø & ‡∞∂‡∞ø‡∞ï‡±ç‡∞∑‡∞£": ["‡∞µ‡∞ø‡∞¶‡±ç‡∞Ø‡∞æ‡∞∞‡±ç‡∞•‡±Å‡∞≤‡±Å", "‡∞í‡∞ï‡±á‡∞∑‡∞®‡∞≤‡±ç", "‡∞∏‡±ç‡∞ï‡±Ç‡∞≤‡±ç", "‡∞ï‡∞æ‡∞≤‡±á‡∞ú‡±Ä", "‡∞ü‡±ç‡∞∞‡±à‡∞®‡∞ø‡∞Ç‡∞ó‡±ç", "‡∞™‡∞∞‡±Ä‡∞ï‡±ç‡∞∑‡∞≤‡±Å"],
    "‡∞∞‡∞æ‡∞ú‡∞ï‡±Ä‡∞Ø‡∞Ç": ["‡∞™‡±ç‡∞∞‡∞≠‡±Å‡∞§‡±ç‡∞µ‡∞Ç", "‡∞é‡∞®‡±ç‡∞®‡∞ø‡∞ï‡∞≤‡±Å", "‡∞™‡∞æ‡∞∞‡±ç‡∞ü‡±Ä", "‡∞Æ‡±Å‡∞ñ‡±ç‡∞Ø‡∞Æ‡∞Ç‡∞§‡±ç‡∞∞‡∞ø", "‡∞Æ‡∞Ç‡∞§‡±ç‡∞∞‡∞ø", "‡∞Æ‡±Å‡∞®‡±ç‡∞∏‡∞ø‡∞™‡∞≤‡±ç"],
    "‡∞µ‡±ç‡∞Ø‡∞µ‡∞∏‡∞æ‡∞Ø‡∞Ç": ["‡∞∞‡±à‡∞§‡±Å", "‡∞™‡∞Ç‡∞ü", "‡∞µ‡∞ø‡∞§‡±ç‡∞§‡∞®‡∞æ‡∞≤‡±Å", "‡∞µ‡∞∞‡∞ø", "‡∞™‡∞§‡±ç‡∞§‡∞ø", "‡∞Æ‡∞æ‡∞∞‡±ç‡∞ï‡±Ü‡∞ü‡±ç"],
    "‡∞ï‡±ç‡∞∞‡±Ä‡∞°‡∞≤‡±Å": ["‡∞ï‡±ç‡∞∞‡∞ø‡∞ï‡±Ü‡∞ü‡±ç", "‡∞Æ‡±ç‡∞Ø‡∞æ‡∞ö‡±ç", "‡∞µ‡∞ø‡∞ú‡∞Ø‡∞ï‡±á‡∞§‡∞®‡∞Ç", "‡∞ï‡±ç‡∞∞‡±Ä‡∞°‡∞≤‡±Å"],
    "‡∞®‡±á‡∞∞‡∞æ‡∞≤‡±Å": ["‡∞™‡±ã‡∞≤‡±Ä‡∞∏‡±ç", "‡∞Ö‡∞∞‡±Ü‡∞∏‡±ç‡∞ü‡±ç", "‡∞ï‡±á‡∞∏‡±Å", "‡∞¶‡±ä‡∞Ç‡∞ó‡∞§‡∞®‡∞Ç"]
};

zipInput.onchange = async e => {
    const zip = await JSZip.loadAsync(e.target.files[0]);
    imageMap = {};
    for (let f in zip.files) {
        if (f.match(/\.(jpg|jpeg|png)$/i)) {
            const blob = await zip.file(f).async("blob");
            imageMap[f.split('/').pop()] = URL.createObjectURL(blob);
        }
    }
    const txtFile = Object.keys(zip.files).find(f => f.endsWith(".txt"));
    const text = await zip.file(txtFile).async("text");
    render(parseAndCategorize(text));
};

function parseAndCategorize(text) {
    const lines = text.split("\n");
    let articles = [];
    let current = { text: "", image: null, category: "‡∞ú‡∞®‡∞∞‡∞≤‡±ç" };

    lines.forEach(line => {
        const match = line.match(/\[.*?\]\s*~?.*?\s*:\s*(.*)/);
        if (!match) return;
        let content = match[1].trim();
        if (content.includes("deleted") || content.includes("omitted")) return;

        const imgMatch = content.match(/<attached:\s*(.*?\.(jpg|jpeg|png))/i);
        if (imgMatch) {
            if (current.text.length > 20) articles.push({...current});
            current = { text: "", image: imageMap[imgMatch[1].trim()], category: "‡∞ú‡∞®‡∞∞‡∞≤‡±ç" };
        } else if (/END|üîö/i.test(content)) {
            if (current.text.length > 20) articles.push({...current});
            current = { text: "", image: null, category: "‡∞ú‡∞®‡∞∞‡∞≤‡±ç" };
        } else {
            current.text += content + "\n";
            for (let cat in categories) {
                if (categories[cat].some(key => content.includes(key))) current.category = cat;
            }
        }
    });
    if (current.text.length > 20) articles.push(current);
    return articles;
}

function render(data) {
    const paper = document.getElementById("paper");
    paper.innerHTML = "";
    
    const grouped = {};
    data.forEach(a => {
        if (!grouped[a.category]) grouped[a.category] = [];
        grouped[a.category].push(a);
    });

    let pageNum = 1;
    for (let cat in grouped) {
        const catArticles = grouped[cat];
        
        // ‡∞í‡∞ï ‡∞ï‡±á‡∞ü‡∞ó‡∞ø‡∞∞‡±Ä‡∞ï‡∞ø ‡∞é‡∞®‡±ç‡∞®‡∞ø ‡∞™‡±á‡∞ú‡±Ä‡∞≤‡±Å ‡∞ï‡∞æ‡∞µ‡∞æ‡∞≤‡±ã ‡∞≤‡±Ü‡∞ï‡±ç‡∞ï‡∞ø‡∞∏‡±ç‡∞§‡±Å‡∞Ç‡∞¶‡∞ø
        const articlesPerPage = 6; 
        for (let i = 0; i < catArticles.length; i += articlesPerPage) {
            const page = document.createElement("div");
            page.className = "page";
            page.innerHTML = `
                <div class="header">
                    <div class="category-ribbon">${cat}</div>
                    <h1>‡∞ú‡∞®‡∞Ç ‡∞®‡±ç‡∞Ø‡±Ç‡∞∏‡±ç</h1>
                    <div class="header-meta">
                        <span>VOLUME: 01</span>
                        <span>‡∞§‡±á‡∞¶‡±Ä: ${new Date().toLocaleDateString('te-IN')}</span>
                        <span>‡∞™‡±á‡∞ú‡±Ä: ${pageNum++}</span>
                    </div>
                </div>
                <div class="columns"></div>
            `;

            const col = page.querySelector(".columns");
            const pageData = catArticles.slice(i, i + articlesPerPage);
            
            pageData.forEach(item => {
                const box = document.createElement("div");
                box.className = "news-box";
                const head = item.text.split("\n")[0].substring(0, 50) + "...";
                box.innerHTML = `
                    <h2>${head}</h2>
                    ${item.image ? `<img src="${item.image}">` : ""}
                    <p>${item.text}</p>
                `;
                col.appendChild(box);
            });
            paper.appendChild(page);
        }
    }
}
</script>
</body>
</html>
