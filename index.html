<!DOCTYPE html>
<html lang="te">
<head>
<meta charset="UTF-8">
<title>‡∞ú‡∞®‡∞Ç ‡∞®‡±ç‡∞Ø‡±Ç‡∞∏‡±ç - ‡∞™‡±Ç‡∞∞‡±ç‡∞§‡∞ø ‡∞µ‡∞æ‡∞∞‡±ç‡∞§‡∞≤ ‡∞é‡∞°‡∞ø‡∞∑‡∞®‡±ç</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Telugu:wght@400;600;700&display=swap" rel="stylesheet">

<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
@page { size: A4; margin: 0; }

body {
    background: #222;
    font-family: 'Noto Sans Telugu', sans-serif;
}

#ui {
    background: white;
    padding: 15px;
    text-align: center;
    border-bottom: 5px solid #b91c1c;
    position: sticky;
    top: 0;
    z-index: 100;
}

.page-container {
    display: flex;
    justify-content: center;
}

.page {
    width: 210mm;
    height: 297mm;
    background: white;
    margin: 10mm;
    padding: 12mm;
    border: 6px double black;
    overflow: hidden;
}

.header {
    text-align: center;
    border-bottom: 3px solid black;
    margin-bottom: 5mm;
}

.header h1 {
    font-size: 48px;
    color: #b91c1c;
    font-weight: 800;
}

.header-meta {
    display: flex;
    justify-content: space-between;
    font-size: 13px;
    font-weight: bold;
    border-top: 1px solid black;
    padding: 5px 10px;
}

.category-ribbon {
    background: #b91c1c;
    color: white;
    padding: 4px 12px;
    font-size: 13px;
    font-weight: bold;
    display: inline-block;
    margin-bottom: 5px;
}

.columns {
    column-count: 3;
    column-gap: 15px;
    column-rule: 0.5px solid #ccc;
    height: calc(297mm - 90mm);
    text-align: justify;
}

.news-box {
    border: 1px solid black;
    padding: 8px;
    margin-bottom: 15px;
    break-inside: avoid-column;
}

.news-box h2 {
    font-size: 15px;
    margin-bottom: 6px;
    border-bottom: 2px solid #b91c1c;
}

.news-box img {
    width: 100%;
    max-height: 220px;
    object-fit: contain;
    margin-bottom: 6px;
}

.news-box p {
    font-size: 11.5px;
    line-height: 1.6;
    white-space: pre-wrap;
}

.nav {
    text-align: center;
    margin: 10px;
}

.nav button {
    padding: 6px 12px;
    font-size: 14px;
}
</style>
</head>

<body>

<div id="ui">
    <h2>üì∞ ‡∞ú‡∞®‡∞Ç ‡∞®‡±ç‡∞Ø‡±Ç‡∞∏‡±ç - Full Newspaper Generator</h2>
    <input type="file" id="zipInput" accept=".zip"><br><br>
    <span id="pageInfo">Page 1</span>
</div>

<div class="page-container">
    <div id="paper"></div>
</div>

<div class="nav">
    <button onclick="prevPage()">‚¨Ö Prev</button>
    <button onclick="nextPage()">Next ‚û°</button>
</div>

<script>
let imageMap = {};
let pages = [];
let currentPage = 0;

const categories = {
    "‡∞∞‡∞æ‡∞ú‡∞ï‡±Ä‡∞Ø‡∞Ç": ["‡∞™‡±ç‡∞∞‡∞≠‡±Å‡∞§‡±ç‡∞µ‡∞Ç","‡∞Æ‡∞Ç‡∞§‡±ç‡∞∞‡∞ø","‡∞é‡∞®‡±ç‡∞®‡∞ø‡∞ï‡∞≤‡±Å"],
    "‡∞ï‡±ç‡∞∞‡±Ä‡∞°‡∞≤‡±Å": ["‡∞ï‡±ç‡∞∞‡∞ø‡∞ï‡±Ü‡∞ü‡±ç","‡∞Æ‡±ç‡∞Ø‡∞æ‡∞ö‡±ç"],
    "‡∞∏‡∞ø‡∞®‡∞ø‡∞Æ‡∞æ": ["‡∞∏‡∞ø‡∞®‡∞ø‡∞Æ‡∞æ","‡∞®‡∞ü‡±Å‡∞°‡±Å"],
    "‡∞∏‡∞æ‡∞Ç‡∞ï‡±á‡∞§‡∞ø‡∞ï‡∞Ç": ["‡∞ü‡±Ü‡∞ï‡±ç‡∞®‡∞æ‡∞≤‡∞ú‡±Ä","AI"],
    "‡∞µ‡∞ø‡∞¶‡±ç‡∞Ø": ["‡∞µ‡∞ø‡∞¶‡±ç‡∞Ø","‡∞™‡∞∞‡±Ä‡∞ï‡±ç‡∞∑"],
    "‡∞µ‡±ç‡∞Ø‡∞µ‡∞∏‡∞æ‡∞Ø‡∞Ç": ["‡∞∞‡±à‡∞§‡±Å","‡∞™‡∞Ç‡∞ü"],
    "‡∞®‡±á‡∞∞‡∞æ‡∞≤‡±Å": ["‡∞™‡±ã‡∞≤‡±Ä‡∞∏‡±ç","‡∞ï‡±á‡∞∏‡±Å"]
};

zipInput.onchange = async e => {
    const zip = await JSZip.loadAsync(e.target.files[0]);
    imageMap = {};

    for (let f in zip.files) {
        if (/\.(jpg|jpeg|png)$/i.test(f)) {
            const blob = await zip.file(f).async("blob");
            imageMap[f.split('/').pop()] = URL.createObjectURL(blob);
        }
    }

    const txt = await zip.file(Object.keys(zip.files).find(f=>f.endsWith(".txt"))).async("text");
    buildPages(parseArticles(txt));
    showPage(0);
};

function parseArticles(text) {
    const lines = text.split(/\r?\n/);
    let articles = [], current = { body:"", image:null, category:"‡∞∏‡∞æ‡∞ß‡∞æ‡∞∞‡∞£‡∞Ç" };

    const push=()=>{
        if(current.body.trim().length>60)
            articles.push({...current, body:current.body.trim()});
        current={ body:"", image:null, category:"‡∞∏‡∞æ‡∞ß‡∞æ‡∞∞‡∞£‡∞Ç" };
    };

    lines.forEach(l=>{
        l=l.replace(/^\[[^\]]+\]\s*[^:]+:\s*/,"").trim();
        if(!l || /image omitted|^end$/i.test(l)) return;

        const img=l.match(/<attached:\s*(.*?\.(jpg|jpeg|png))/i);
        if(img){ current.image=imageMap[img[1]]; return; }

        current.body+=l+"\n";
        for(let c in categories)
            if(categories[c].some(k=>l.includes(k))) current.category=c;
    });
    push();
    return articles;
}

function titleFrom(text){
    return text.split("\n")[0].substring(0,60);
}

function buildPages(data){
    pages=[];
    let idx=0;
    while(idx<data.length){
        const page=document.createElement("div");
        page.className="page";
        page.innerHTML=`
        <div class="header">
            <div class="category-ribbon">${data[idx].category}</div>
            <h1>‡∞ú‡∞®‡∞Ç ‡∞®‡±ç‡∞Ø‡±Ç‡∞∏‡±ç</h1>
            <div class="header-meta">
                <span>VOL 01</span>
                <span>${new Date().toLocaleDateString('te-IN')}</span>
            </div>
        </div>
        <div class="columns"></div>`;
        const col=page.querySelector(".columns");

        while(idx<data.length){
            const a=data[idx];
            const box=document.createElement("div");
            box.className="news-box";
            box.innerHTML=`<h2>${titleFrom(a.body)}</h2>${a.image?`<img src="${a.image}">`:""}<p>${a.body}</p>`;
            col.appendChild(box);
            if(page.scrollHeight>page.clientHeight+5){
                col.removeChild(box);
                break;
            }
            idx++;
        }
        pages.push(page);
    }
}

function showPage(n){
    if(n<0||n>=pages.length) return;
    currentPage=n;
    paper.innerHTML="";
    paper.appendChild(pages[n]);
    pageInfo.innerText=`Page ${n+1} / ${pages.length}`;
}
function nextPage(){ showPage(currentPage+1); }
function prevPage(){ showPage(currentPage-1); }
</script>

</body>
</html>
