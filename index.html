<!DOCTYPE html>
<html lang="te">
<head>
<meta charset="UTF-8">
<title>‡∞ú‡∞®‡∞Ç ‡∞®‡±ç‡∞Ø‡±Ç‡∞∏‡±ç - ‡∞µ‡∞∞‡±ç‡∞ó‡±Ä‡∞ï‡∞∞‡∞ø‡∞Ç‡∞ö‡∞¨‡∞°‡∞ø‡∞® ‡∞é‡∞°‡∞ø‡∞∑‡∞®‡±ç</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Telugu:wght@400;600;700&display=swap" rel="stylesheet">

<style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    @page { size: A4; margin: 0; }
    body { background: #222; font-family: 'Noto Sans Telugu', sans-serif; padding-bottom: 50px; }

    .page {
        width: 210mm; height: 297mm; background: white; margin: 10mm auto;
        padding: 12mm; position: relative; page-break-after: always;
        border: 6px double black; overflow: hidden;
    }

    /* Category Ribbon */
    .category-ribbon {
        background: #000; color: #fff; padding: 5px 15px;
        font-size: 14px; font-weight: bold; text-transform: uppercase;
        display: inline-block; margin-bottom: 5px;
    }

    .header { text-align: center; border-bottom: 3px solid black; margin-bottom: 5mm; }
    .header h1 { font-size: 55px; font-weight: 800; color: #b91c1c; }
    
    .header-meta {
        display: flex; justify-content: space-between; font-weight: bold;
        font-size: 14px; border-top: 1px solid black; padding: 5px 10px;
    }

    .columns {
        column-count: 3; column-gap: 20px; column-rule: 1px solid #000;
        height: calc(297mm - 85mm); width: 100%;
    }

    .news-box {
        break-inside: avoid; border: 1.5px solid #000;
        margin-bottom: 20px; padding: 10px; background: #fff;
    }

    .news-box h2 {
        font-size: 16px; margin-bottom: 8px; color: #000;
        border-bottom: 2px solid #b91c1c; padding-bottom: 3px;
    }

    .news-box img {
        width: 100%; max-height: 250px; object-fit: contain;
        margin-bottom: 10px; border: 1px solid #ddd;
    }

    .news-box p { font-size: 12px; line-height: 1.8; text-align: justify; }

    #ui { background: white; padding: 20px; text-align: center; border-bottom: 5px solid #b91c1c; position: sticky; top:0; z-index:100; }
</style>
</head>
<body>

<div id="ui">
    <h2>üì∞ ‡∞ú‡∞®‡∞Ç ‡∞®‡±ç‡∞Ø‡±Ç‡∞∏‡±ç - ‡∞µ‡∞∞‡±ç‡∞ó‡±Ä‡∞ï‡∞∞‡∞ø‡∞Ç‡∞ö‡∞¨‡∞°‡∞ø‡∞® ‡∞é‡∞°‡∞ø‡∞∑‡∞®‡±ç (Categorized)</h2>
    <input type="file" id="zipInput" accept=".zip">
    <p class="small mt-2">Politics | Sports | Technology | Crime | Agriculture</p>
</div>

<div id="paper"></div>

<script>
let imageMap = {};

// Keyword rules for categorization
const categories = {
    "‡∞∞‡∞æ‡∞ú‡∞ï‡±Ä‡∞Ø‡∞Ç (Politics)": ["‡∞™‡±ç‡∞∞‡∞≠‡±Å‡∞§‡±ç‡∞µ‡∞Ç", "‡∞Æ‡±Å‡∞®‡±ç‡∞∏‡∞ø‡∞™‡∞≤‡±ç", "‡∞é‡∞®‡±ç‡∞®‡∞ø‡∞ï‡∞≤‡±Å", "‡∞™‡∞æ‡∞∞‡±ç‡∞ü‡±Ä", "‡∞Æ‡±Å‡∞ñ‡±ç‡∞Ø‡∞Æ‡∞Ç‡∞§‡±ç‡∞∞‡∞ø", "‡∞Æ‡∞Ç‡∞§‡±ç‡∞∞‡∞ø"],
    "‡∞ï‡±ç‡∞∞‡±Ä‡∞°‡∞≤‡±Å (Sports)": ["‡∞ï‡±ç‡∞∞‡∞ø‡∞ï‡±Ü‡∞ü‡±ç", "‡∞Æ‡±ç‡∞Ø‡∞æ‡∞ö‡±ç", "‡∞ï‡±ç‡∞∞‡±Ä‡∞°‡∞≤‡±Å", "‡∞µ‡∞ø‡∞ú‡∞Ø‡∞Ç", "‡∞ï‡±ã‡∞ö‡±ç"],
    "‡∞∏‡∞æ‡∞Ç‡∞ï‡±á‡∞§‡∞ø‡∞ï‡∞§ (Technology)": ["‡∞´‡±ã‡∞®‡±ç", "‡∞ü‡±Ü‡∞ï‡±ç‡∞®‡∞æ‡∞≤‡∞ú‡±Ä", "‡∞Ü‡∞®‡±ç‡∞≤‡±à‡∞®‡±ç", "‡∞°‡∞ø‡∞ú‡∞ø‡∞ü‡∞≤‡±ç", "‡∞Ø‡∞æ‡∞™‡±ç"],
    "‡∞µ‡±ç‡∞Ø‡∞µ‡∞∏‡∞æ‡∞Ø‡∞Ç (Agriculture)": ["‡∞∞‡±à‡∞§‡±Å", "‡∞™‡∞Ç‡∞ü", "‡∞µ‡∞ø‡∞§‡±ç‡∞§‡∞®‡∞æ‡∞≤‡±Å", "‡∞µ‡∞∞‡∞ø", "‡∞™‡∞§‡±ç‡∞§‡∞ø", "‡∞µ‡±á‡∞∞‡±Å‡∞∂‡∞®‡∞ó"],
    "‡∞®‡±á‡∞∞‡∞æ‡∞≤‡±Å (Crime)": ["‡∞™‡±ã‡∞≤‡±Ä‡∞∏‡±ç", "‡∞Ö‡∞∞‡±Ü‡∞∏‡±ç‡∞ü‡±ç", "‡∞ï‡±á‡∞∏‡±Å", "‡∞®‡±á‡∞∞‡∞Ç", "‡∞¶‡±ä‡∞Ç‡∞ó‡∞§‡∞®‡∞Ç"]
};

zipInput.onchange = async e => {
    const zip = await JSZip.loadAsync(e.target.files[0]);
    imageMap = {};
    for (let f in zip.files) {
        if (f.match(/\.(jpg|jpeg|png)$/i)) {
            const blob = await zip.file(f).async("blob");
            imageMap[f.split('/').pop()] = URL.createObjectURL(blob);
        }
    }
    const txtFile = Object.keys(zip.files).find(f => f.endsWith(".txt"));
    const text = await zip.file(txtFile).async("text");
    render(parseAndCategorize(text));
};

function parseAndCategorize(text) {
    const lines = text.split("\n");
    let articles = [];
    let current = { text: "", image: null, category: "‡∞ú‡∞®‡∞∞‡∞≤‡±ç (General)" };

    lines.forEach(line => {
        const match = line.match(/\[.*?\]\s*~?.*?\s*:\s*(.*)/);
        if (!match) return;
        let content = match[1].trim();
        if (content.includes("deleted") || content.includes("omitted")) return;

        const imgMatch = content.match(/<attached:\s*(.*?\.(jpg|jpeg|png))/i);
        if (imgMatch) {
            if (current.text.length > 30) articles.push({...current});
            current = { text: "", image: imageMap[imgMatch[1].trim()], category: "‡∞ú‡∞®‡∞∞‡∞≤‡±ç (General)" };
        } else if (/END|üîö/i.test(content)) {
            if (current.text.length > 30) articles.push({...current});
            current = { text: "", image: null, category: "‡∞ú‡∞®‡∞∞‡∞≤‡±ç (General)" };
        } else {
            current.text += content + " ";
            // Dynamic categorization logic
            for (let cat in categories) {
                if (categories[cat].some(key => content.includes(key))) {
                    current.category = cat;
                }
            }
        }
    });
    return articles;
}

function render(data) {
    const paper = document.getElementById("paper");
    paper.innerHTML = "";
    
    // Group articles by category for page separation
    const grouped = {};
    data.forEach(a => {
        if (!grouped[a.category]) grouped[a.category] = [];
        grouped[a.category].push(a);
    });

    let pageNum = 1;
    for (let cat in grouped) {
        const catArticles = grouped[cat];
        const page = document.createElement("div");
        page.className = "page";
        page.innerHTML = `
            <div class="header">
                <div class="category-ribbon">${cat}</div>
                <h1>‡∞ú‡∞®‡∞Ç ‡∞®‡±ç‡∞Ø‡±Ç‡∞∏‡±ç</h1>
                <div class="header-meta">
                    <span>‡∞®‡∞ø‡∞ú‡∞æ‡∞Ø‡∞ø‡∞§‡±Ä ‡∞ó‡∞≤ ‡∞µ‡∞æ‡∞∞‡±ç‡∞§‡∞≤‡±Å</span>
                    <span>‡∞§‡±á‡∞¶‡±Ä: ${new Date().toLocaleDateString('te-IN')}</span>
                    <span>‡∞™‡±á‡∞ú‡±Ä: ${pageNum++}</span>
                </div>
            </div>
            <div class="columns"></div>
        `;

        const col = page.querySelector(".columns");
        catArticles.forEach(item => {
            const box = document.createElement("div");
            box.className = "news-box";
            box.innerHTML = `
                <h2>${item.text.split(" ").slice(0, 6).join(" ")}...</h2>
                ${item.image ? `<img src="${item.image}">` : ""}
                <p>${item.text}</p>
            `;
            col.appendChild(box);
        });
        paper.appendChild(page);
    }
}
</script>
</body>
</html>
