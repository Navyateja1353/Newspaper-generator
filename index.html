<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Believe It Newspaper Generator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Georgia', serif; background: #f5f5f5; }
        .newspaper { max-width: 1200px; margin: 20px auto; background: white; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .header { background: linear-gradient(90deg, #d32f2f, #f44336); color: white; padding: 40px; text-align: center; }
        .upload-zone { border: 3px dashed #1976d2; border-radius: 15px; padding: 50px; text-align: center; margin: 30px 0; background: #fafafa; }
        .content-panel { min-height: 400px; padding: 30px; border-radius: 10px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); margin: 20px 0; }
        .raw-data { background: #f8f9fa; }
        .ai-layout { background: white; column-count: 4; column-gap: 30px; }
        .priority-1 { background: linear-gradient(135deg, #ff6b6b, #ee5a52); color: white; padding: 30px; border-radius: 15px; margin-bottom: 30px; }
        .priority-2 { background: linear-gradient(135deg, #4ecdc4, #44a08d); color: white; padding: 25px; border-radius: 12px; margin-bottom: 25px; }
        .priority-3 { background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .generate-btn { background: linear-gradient(45deg, #667eea, #764ba2); border: none; color: white; padding: 15px 40px; font-size: 1.2rem; border-radius: 30px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container newspaper">
        <div class="header">
            <h1 style="font-size: 3rem; margin: 0;">üì∞ BELIEVE IT DAILY</h1>
            <p style="font-size: 1.3rem; opacity: 0.95;">WhatsApp Channel ‚Üí AI Newspaper Generator</p>
        </div>

        <div class="upload-zone" id="uploadZone">
            <h3>üì± Upload WhatsApp Export (.txt)</h3>
            <p>Daily channel export ‚Üí AI analysis ‚Üí Perfect newspaper layout</p>
            <input type="file" id="whatsappFile" accept=".txt" style="display: none;">
            <button class="btn btn-primary btn-lg mt-3" onclick="document.getElementById('whatsappFile').click()">
                üì§ Choose WhatsApp Export
            </button>
        </div>

        <div class="row">
            <!-- Raw WhatsApp Data -->
            <div class="col-md-6">
                <div class="content-panel raw-data">
                    <h4>üìã Raw Channel Data</h4>
                    <div id="rawData" style="max-height: 400px; overflow-y: auto;"></div>
                </div>
            </div>

            <!-- AI Priority Analysis -->
            <div class="col-md-6">
                <div class="content-panel">
                    <h4>ü§ñ AI Priority Analysis</h4>
                    <div id="priorityAnalysis"></div>
                </div>
            </div>
        </div>

        <!-- AI Newspaper Layout -->
        <div class="content-panel ai-layout">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                <h3 style="margin: 0;">üóûÔ∏è Final Newspaper Layout</h3>
                <button class="generate-btn" id="generatePDF" style="display: none;">üìÑ PRINT NEWSPAPER</button>
            </div>
            <div id="newspaperLayout"></div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script>
        let whatsappMessages = [];

        document.getElementById('whatsappFile').addEventListener('change', handleWhatsAppExport);

        function handleWhatsAppExport(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                parseWhatsAppExport(content);
            };
            reader.readAsText(file);
        }

        function parseWhatsAppExport(content) {
            // Parse WhatsApp export format
            const lines = content.split('\n');
            whatsappMessages = [];
            
            lines.forEach(line => {
                // WhatsApp format: [19/12/25, 9:45:32 AM] Channel Name: Message text
                const timeMatch = line.match(/\[(\d{1,2}\/\d{1,2}\/\d{2}),\s*(\d{1,2}:\d{2}:\d{2}\s*(?:AM|PM))\]\s*([^:]+):\s*(.*)/);
                if (timeMatch) {
                    whatsappMessages.push({
                        timestamp: timeMatch[1] + ' ' + timeMatch[2],
                        channel: timeMatch[3].trim(),
                        text: timeMatch[4].trim()
                    });
                }
            });

            // Reverse for chronological (newest first)
            whatsappMessages = whatsappMessages.reverse().slice(0, 20); // Last 20 messages

            renderRawData();
            aiAnalyzePriority();
        }

        function renderRawData() {
            const container = document.getElementById('rawData');
            container.innerHTML = whatsappMessages.map(msg => `
                <div style="padding: 15px; border-bottom: 1px solid #eee; font-size: 0.95rem;">
                    <strong>${msg.channel}</strong><br>
                    <small style="color: #666;">${msg.timestamp}</small><br>
                    ${msg.text}
                </div>
            `).join('');
        }

        function aiAnalyzePriority() {
            // AI Priority Scoring
            const prioritized = whatsappMessages.map(msg => {
                let score = 0;
                const text = msg.text.toLowerCase();
                
                // Priority keywords
                if (text.includes('breaking') || text.includes('urgent') || text.includes('alert')) score += 30;
                if (text.includes('pm') || text.includes('modi') || text.includes('president')) score += 25;
                if (text.includes('rupee') || text.includes('sensex') || text.includes('stock')) score += 20;
                if (text.includes('bengaluru') || text.includes('delhi') || text.includes('mumbai')) score += 15;
                if (msg.channel.includes('BBC') || msg.channel.includes('NDTV') || msg.channel.includes('ANI')) score += 10;
                
                msg.priorityScore = score;
                return msg;
            }).sort((a, b) => b.priorityScore - a.priorityScore);

            renderPriorityAnalysis(prioritized);
            generateNewspaperLayout(prioritized);
            document.getElementById('generatePDF').style.display = 'inline-block';
        }

        function renderPriorityAnalysis(messages) {
            const container = document.getElementById('priorityAnalysis');
            container.innerHTML = `
                <div style="margin-bottom: 20px;">
                    <h6>ü•á Top Priority (${messages[0]?.priorityScore || 0})</h6>
                    <strong>${messages[0]?.channel}: ${messages[0]?.text}</strong>
                </div>
                <div style="margin-bottom: 20px;">
                    <h6>ü•à Page 1 Stories</h6>
                    ${messages.slice(1, 4).map(msg => `<div>‚Ä¢ ${msg.channel}: ${msg.text}</div>`).join('')}
                </div>
                <div>
                    <h6>üìÑ Column Fillers</h6>
                    ${messages.slice(4, 10).map(msg => `<div>‚Ä¢ ${msg.text.substring(0, 80)}...</div>`).join('')}
                </div>
            `;
        }

        function generateNewspaperLayout(messages) {
            const container = document.getElementById('newspaperLayout');
            let html = '';

            // PAGE 1: Top Story (Highest priority)
            html += `
                <div class="priority-1">
                    <h2 style="font-size: 2.2rem; margin-bottom: 20px;">${messages[0]?.text}</h2>
                    <div style="font-size: 1.3rem; opacity: 0.95;">${messages[0]?.channel}</div>
                </div>
            `;

            // PAGE 1: Secondary stories
            messages.slice(1, 4).forEach(msg => {
                html += `
                    <div class="priority-2">
                        <h3 style="margin-bottom: 10px;">${msg.text}</h3>
                        <div>${msg.channel}</div>
                    </div>
                `;
            });

            // PAGES 2+: Column stories
            messages.slice(4).forEach(msg => {
                html += `
                    <div class="priority-3">
                        <h4 style="margin-bottom: 10px;">${msg.text}</h4>
                        <div style="color: #666; font-size: 0.95rem;">${msg.channel}</div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        // PDF Generation
        document.getElementById('generatePDF').onclick = async () => {
            const newspaper = document.querySelector('.newspaper');
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'mm', 'a4');
            
            const canvas = await html2canvas(newspaper, { scale: 2 });
            const imgData = canvas.toDataURL('image/png');
            const imgWidth = 210;
            const pageHeight = 295;
            const imgHeight = (canvas.height * imgWidth) / canvas.width;
            let heightLeft = imgHeight;
            let position = 0;

            doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
            heightLeft -= pageHeight;
            while (heightLeft >= 0) {
                position = heightLeft - imgHeight;
                doc.addPage();
                doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
            }
            doc.save('believe-it-newspaper.pdf');
        };
    </script>
</body>
</html>

